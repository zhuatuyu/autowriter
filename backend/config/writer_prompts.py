#!/usr/bin/env python
"""
ç« èŠ‚å†™ä½œï¼ˆSOP2ï¼‰ç›¸å…³å¸¸é‡ï¼ˆæ›¿ä»£ YAML é…ç½®ï¼Œä¾› section_writer_action/architect_content_action ä½¿ç”¨ï¼‰
"""

WRITER_BASE_SYSTEM = (
    "ä½ æ˜¯ç»©æ•ˆè¯„ä»·æŠ¥å‘Šçš„å†™ä½œä¸“å®¶ã€‚ä½ çš„ç›®æ ‡æ˜¯ï¼š\n"
    "1. åŸºäºŽäº‹å®žä¾æ®å’Œæ•°æ®æ”¯æ’‘ï¼Œæ’°å†™é«˜è´¨é‡çš„æŠ¥å‘Šç« èŠ‚\n"
    "2. ä¸¥æ ¼éµå¾ªæž¶æž„å¸ˆåˆ¶å®šçš„å†™ä½œæŒ‡å¯¼å’Œæ£€ç´¢è¦æ±‚\n"
    "3. ç¡®ä¿å†…å®¹ä¸“ä¸šã€å‡†ç¡®ã€æ·±å…¥ï¼Œç¬¦åˆç»©æ•ˆè¯„ä»·æŠ¥å‘Šçš„æ ‡å‡†"
)

SECTION_WRITING_PROMPT = (
    "è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯æ’°å†™æŠ¥å‘Šç« èŠ‚ï¼š\n\n"
    "## ç« èŠ‚æ ‡é¢˜\n{section_title}\n\n"
    "## å†™ä½œè¦æ±‚ä¸ŽæŒ‡å¯¼\n{instruction}\n\n"
    "## ç›¸å…³äº‹å®žä¾æ®ï¼ˆæ¥è‡ªå‘é‡æ£€ç´¢ï¼‰\n{factual_basis}\n\n"
    "## å…³è”çš„ç»©æ•ˆæŒ‡æ ‡\n{metrics_text}\n\n"
    "## ðŸ“‹ å†™ä½œæ ‡å‡†ä¸Žè´¨é‡è¦æ±‚\n"
    "1. æ•°æ®é©±åŠ¨ï¼šåŸºäºŽäº‹å®žä¾æ®ï¼Œé¿å…ç©ºæ³›\n"
    "2. ç»“æž„æ¸…æ™°ï¼šæŒ‰æŒ‡å¯¼é¡ºåºç»„ç»‡å†…å®¹\n"
    "3. æ·±åº¦åˆ†æžï¼šç»™å‡ºåŽŸå› ã€å½±å“ä¸Žè¶‹åŠ¿\n"
)

# ç« èŠ‚æç¤ºè¯ç”Ÿæˆæ¨¡æ¿ï¼ˆæž¶æž„å¸ˆç”¨äºŽæ‹¼è£…ç« èŠ‚å†™ä½œæŒ‡å¯¼ï¼‰
SECTION_PROMPT_GENERATION_TEMPLATE = (
    "{base_prompt}\n\n"
    "### ðŸ“‹ å…·ä½“å†™ä½œæŒ‡å¯¼ä¸Žæ£€ç´¢è¦æ±‚ï¼š\n"
    "{rag_instructions}\n\n"
    "### ðŸ” RAGæ£€ç´¢ç­–ç•¥ï¼š\n"
    "1. ä¼˜å…ˆæ£€ç´¢å…³é”®ä¿¡æ¯é¡¹ï¼ŒèŽ·å–å…·ä½“æ•°æ®å’Œäº‹å®ž\n"
    "2. åŸºäºŽæ£€ç´¢åˆ°çš„çœŸå®žä¿¡æ¯è¿›è¡Œåˆ†æžå’Œè®ºè¿°\n"
    "3. é¿å…æ³›æ³›è€Œè°ˆï¼Œç¡®ä¿æ¯ä¸ªè®ºç‚¹éƒ½æœ‰å…·ä½“çš„æ•°æ®æ”¯æ’‘\n"
    "4. å¦‚ç¼ºå¤±ä¿¡æ¯ï¼Œæ ‡æ³¨ \"ä¿¡æ¯å¾…è¡¥å……\"\n"
)

# æŠ¥å‘Šç« èŠ‚ç»“æž„ï¼ˆSOP2 é»˜è®¤äº”ç« ï¼‰
REPORT_SECTIONS = [
    {"title": "ä¸€ã€é¡¹ç›®æ¦‚è¿°", "key": "overview", "prompt_template": "è¯·å›´ç»•é¡¹ç›®èƒŒæ™¯ã€èµ„é‡‘ä¸Žé¢„ç®—ã€å®žæ–½æƒ…å†µã€ç»„ç»‡ç®¡ç†ã€ç»©æ•ˆç›®æ ‡ï¼ˆè¡¨æ ¼å±•ç¤ºï¼‰è¿›è¡Œæ’°å†™ã€‚"},
    {"title": "äºŒã€ç»¼åˆç»©æ•ˆè¯„ä»·ç»“è®º", "key": "conclusion", "prompt_template": "å¿…é¡»ä¾æ® metric_analysis_table.md çš„è¯„åˆ†ç»“æžœï¼Œæ±‡æ€»æ€»åˆ†ä¸Žå„ç»´åº¦åˆ†å€¼ä¸Žå¾—åˆ†çŽ‡ï¼Œå¹¶å¼•ç”¨å…³é”®opinionè¦ç‚¹ã€‚"},
    {"title": "ä¸‰ã€ä¸»è¦æˆæ•ˆåŠç»éªŒ", "key": "achievements", "prompt_template": "ç»“åˆæ•°æ®å’Œäº‹å®žï¼Œæ€»ç»“æˆæ•ˆï¼Œæç‚¼å¯å€Ÿé‰´åšæ³•ã€‚"},
    {"title": "å››ã€å­˜åœ¨çš„é—®é¢˜å’ŒåŽŸå› åˆ†æž", "key": "problems", "prompt_template": "é’ˆå¯¹æ‰£åˆ†é¡¹é€æ¡åˆ†æžåŽŸå› ã€ä¾æ®ä¸Žå½±å“èŒƒå›´ã€‚"},
    {"title": "äº”ã€æ”¹è¿›å»ºè®®", "key": "suggestions", "prompt_template": "é’ˆå¯¹é—®é¢˜æå‡ºå…·ä½“å¯æ“ä½œå»ºè®®ï¼Œæ ‡æ³¨è´£ä»»ä¸Žé¢„æœŸæ•ˆæžœã€‚"},
]

# ç« èŠ‚ç‰¹å®šé…ç½®ï¼ˆRAGæŒ‡å¼•ï¼‰
SECTION_CONFIGURATIONS = {
    "overview": {
        "title_keywords": ["é¡¹ç›®æ¦‚è¿°", "æ¦‚è¿°"],
        "rag_instructions": (
            "1) é¡¹ç›®ç«‹é¡¹èƒŒæ™¯åŠç›®çš„ï¼šæ”¿ç­–ä¾æ®/ç«‹é¡¹ä¾æ®/ç›®æ ‡è®¾å®š\n"
            "2) èµ„é‡‘æŠ•å…¥å’Œä½¿ç”¨æƒ…å†µï¼šé¢„ç®—æ€»é¢ã€æ¥æºã€åˆ†é…ã€æ‰§è¡Œè¿›åº¦\n"
            "3) é¡¹ç›®ç»„ç»‡ç®¡ç†ï¼šæœºæž„ã€èŒè´£åˆ†å·¥ã€æµç¨‹åˆ¶åº¦\n"
            "4) ç»©æ•ˆç›®æ ‡ï¼šç»©æ•ˆç›®æ ‡è¡¨ã€æŒ‡æ ‡è®¾å®šã€é¢„æœŸæˆæžœï¼ˆè¡¨æ ¼å±•ç¤ºï¼‰"
        ),
    },
    "conclusion": {
        "title_keywords": ["ç»¼åˆç»©æ•ˆè¯„ä»·ç»“è®º", "è¯„ä»·ç»“è®º", "ç»©æ•ˆç»“è®º"],
        "rag_instructions": (
            "- æ±‡æ€»ï¼šå„ç»´åº¦ï¼ˆå†³ç­–/è¿‡ç¨‹/äº§å‡º/æ•ˆç›Šï¼‰å¾—åˆ†ä¸Žå¾—åˆ†çŽ‡\n"
            "- ä¾æ®ï¼šå¼•ç”¨æŒ‡æ ‡è¡¨å…³é”® opinion è¦ç‚¹\n"
            "- è¾“å‡ºï¼šä¸€çº§æŒ‡æ ‡å¾—åˆ†è¡¨ï¼ˆåˆ†å€¼ã€å¾—åˆ†ã€å¾—åˆ†çŽ‡ï¼‰"
        ),
    },
    "achievements": {
        "title_keywords": ["ä¸»è¦æˆæ•ˆåŠç»éªŒ", "æˆæ•ˆ", "ç»éªŒ"],
        "rag_instructions": (
            "- å…·ä½“æˆæ•ˆæ•°æ®ï¼šé‡åŒ–æˆæžœã€å—ç›Šäººç¾¤ã€å¯¹æ¯”æ•°æ®\n"
            "- æˆåŠŸç»éªŒæ€»ç»“ï¼šåˆ›æ–°åšæ³•ã€ç®¡ç†ç»éªŒã€æŠ€æœ¯äº®ç‚¹"
        ),
    },
    "problems": {
        "title_keywords": ["å­˜åœ¨çš„é—®é¢˜å’ŒåŽŸå› åˆ†æž", "é—®é¢˜", "åŽŸå› åˆ†æž"],
        "rag_instructions": (
            "- é—®é¢˜è¯†åˆ«ï¼šè°ƒç ”å‘çŽ°/æ•°æ®åæ˜ /åé¦ˆæ„è§\n"
            "- åŽŸå› åˆ†æžï¼šæ”¿ç­–æ‰§è¡Œ/ç®¡ç†åˆ¶åº¦/æŠ€æœ¯æ¡ä»¶/å¤–éƒ¨çŽ¯å¢ƒ\n"
            "- å¯¹æŽ¥æŒ‡æ ‡ï¼šç»“åˆæ‰£åˆ†é¡¹çš„åŽŸå› ã€ä¾æ®ã€å½±å“èŒƒå›´"
        ),
    },
    "suggestions": {
        "title_keywords": ["æ”¹è¿›å»ºè®®", "å»ºè®®"],
        "rag_instructions": (
            "- é’ˆå¯¹æ€§å»ºè®®ï¼šè´£ä»»ä¸»ä½“/æ—¶é—´å®‰æŽ’/é¢„æœŸæ•ˆæžœ\n"
            "- å¯æ“ä½œæ€§éªŒè¯ï¼šç±»ä¼¼é¡¹ç›®æœ€ä½³å®žè·µ/æ”¿ç­–å¯è¡Œæ€§"
        ),
    },
}

def GET_SECTION_KEY_BY_TITLE(section_title: str) -> str:
    title = section_title or ""
    for key, cfg in SECTION_CONFIGURATIONS.items():
        for kw in cfg.get("title_keywords", []):
            if kw in title:
                return key
    return "general"

def GET_SECTION_CONFIG(section_key: str) -> dict:
    return SECTION_CONFIGURATIONS.get(section_key, {})


