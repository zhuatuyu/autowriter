# 系统级提示


RESEARCH_TOPIC_SYSTEM = (
    "你是一名调研专家，对需求:{topic} 进行全方位研究"
)

# 关键词与问题分解/URL排序/网页分析
SEARCH_KEYWORDS_PROMPT = (
    "请根据你的研究需求，提供最多3个必要的关键词用于网络搜索。\n"
    "这些关键词应该能够帮助收集到最相关和最有价值的信息。\n"
    "你的回应必须是JSON格式，例如：[\"关键词1\", \"关键词2\", \"关键词3\"]。"
)

# 研究辅助项：统一研究方向种子（用于稳定直出检索问题，引导高质量关键词）
DECOMPOSITION_DIMENSIONS = [
    "风险与问题：进度/质量/资金合规风险",
    "改进与建议：对风险和问题提出的整改和建议",
    "可借鉴案例：同类型/同地域/同规模项目的可复制机制（不引用具体数据）",
]

DECOMPOSE_RESEARCH_PROMPT = (
    "### 要求\n"
    "1. 你的研究需求和初步搜索结果展示在\"参考信息\"部分。\n"
    "2. 请基于这些信息，生成最多 {decomposition_nums} 个与当前项目相关的、更具体的调查问题。\n"
    "3. 你的回应必须是JSON格式：[\"问题1\", \"问题2\", ...]。\n\n"
    "### 收集重点\n"
    "生成的问题应该能够收集到以下类型的具体事实：\n"
    "- 政策依据：文件名称、文号、关键条款、适用范围等\n"
    "- 实施细节：具体措施、流程步骤、责任主体、资源配置等\n"
    "- 指标体系：评价标准、评价方法、评价结果等\n"
    "- 效果评估：实际效果、影响范围、受益对象、相关满意度等\n"
    "- 问题分析：具体问题、原因分析、影响评估等\n"
    "- 改进建议：可操作措施、预期效果、实施路径、资源需求等\n\n"
    "### 参考信息\n{search_results}"
)

RANK_URLS_PROMPT = (
    "### 需求\n{topic}\n"
    "### 具体问题\n{query}\n"
    "### 原始搜索结果\n{results}\n"
    "### 要求\n"
    "1) 先移除不相关的搜索结果；\n"
    "2) 如果问题具有时效性，移除过时信息（当前时间 {time_stamp}）；\n"
    "3) 域名白名单强约束：只保留以下来源（非白名单一律淘汰）：\n"
    "   - *.gov.cn、*.edu.cn 及权威部委官网\n"
    "   - 权威机构/监管部门官方网站\n"
    "   - 主流权威媒体与学术数据库\n"
    "4) 在白名单结果中再按可信度与相关性排序；\n"
    "5) 仅以 JSON 数组输出排序后保留结果的索引，例如 [0, 1, 3]。"
)

WEB_CONTENT_ANALYSIS_PROMPT = (
    "### 要求\n"
    "1. 利用\"参考信息\"中的文本来回答问题\"{query}\"。\n"
    "2. 若无法直接回答但内容相关，请进行全面总结；完全不相关则回复\"不相关\"。\n"
    "### 提取重点\n"
    "在总结内容时，请特别关注并提取以下具体事实：\n"
    "- 政策依据：文件名称、文号、关键条款、适用范围等\n"
    "- 实施细节：具体措施、流程步骤、责任主体、资源配置等\n"
    "- 指标体系：评价标准、评价方法、评价结果等\n"
    "- 效果评估：实际效果、影响范围、受益对象、相关满意度等\n"
    "- 问题分析：具体问题、原因分析、影响评估等\n"
    "- 改进建议：可操作措施、预期效果、实施路径、资源需求等\n\n"
    "### 参考信息\n{content}"
)

COMPREHENSIVE_RESEARCH_BASE_SYSTEM = (
    "你是一名专业的AI研究分析师和产品经理。你的目标是：\n"
    "1. 深入理解用户需求和业务背景\n"
    "2. 进行全面的市场和案例研究\n"
    "3. 生成高质量的研究简报，为后续的架构设计和内容生成提供坚实基础\n\n"
    "【事实收集原则】\n"
    "- 优先收集量化数据：具体数字、百分比、时间、金额、数量等\n"
    "- 注重政策依据：文件名称、文号、关键条款、适用范围等\n"
    "- 关注实施细节：具体措施、流程步骤、责任主体、资源配置等\n"
    "- 重视效果评估：成果数据、影响范围、受益对象、满意度等\n"
    "- 深入问题分析：具体问题、数据支撑、原因分析、影响评估等\n"
    "- 提供改进建议：可操作措施、预期效果、实施路径、资源需求等\n\n"
    "【质量要求】\n"
    "- 所有结论必须有具体事实支撑\n"
    "- 避免泛泛而谈，必须提供可验证的信息\n"
    "- 优先使用权威来源和一手资料\n"
    "- 确保信息的时效性和准确性"
)

# 研究简报（可维护版本，仅6键内容 + 可选元信息）
# 统一：仅输出指定6键，禁止旧字段（achievements/conclusion/suggestions/metric_focus 等）
GENERATE_RESEARCH_BRIEF_PROMPT = (
    "【输出格式硬性约束 - 仅输出JSON（扁平结构）】\n"
    "- 你必须仅输出一个 JSON 对象，键严格为：\n"
    "  [\"项目情况\",\"资金情况\",\"重要事件\",\"政策引用\",\"推荐方法\",\"可借鉴网络案例\"]。\n"
    "- 严禁输出除上述键之外的任何键；禁止输出 achievements/conclusion/suggestions/metric_focus 等旧字段。\n"
    "- allowed_web_urls: {allowed_web_urls}\n- allowed_project_docs: {allowed_project_docs}\n\n"
    "【写作要求】\n"
    "- 项目情况/资金情况：汇总为可读段落，允许分行；实事求是，避免虚构\n"
    "- 重要事件：按时间线组织；相同日期且同类型的支付/拨付合并为单行并汇总金额；优先保留里程碑（立项/招标/合同/开工/验收/结算/关键支付节点）；无法确定时间可标注为‘[未知时间]’\n"
    "- 政策引用：使用‘全称+文号/条款/页码/URL(如有)’等可复核表述；可多条例串联\n"
    "- 推荐方法：输出为可复用的要点清单（方法; 标准; 工具; 模型; 评估流程等，以分号分隔），严禁写成问句\n"
    "- 可借鉴网络案例：输出为‘《案例名》（来源：文件名.后缀）; ……’格式，至少2条，严禁写成问句\n\n"
    "【仅输出JSON示例】\n"
    "{{\n"
    "  \"项目情况\": \"...\",\n"
    "  \"资金情况\": \"...\",\n"
    "  \"重要事件\": \"[2024-11-21 00:00] 项目开工...\\n[2025-01-26 00:00] 合并支付进度款与结算款：金额合计 XXX 元 ...\",\n"
    "  \"政策引用\": \"《XX办法》（文号）第X条：...（链接：URL，如有）；《XX规程》（文号）第Y条：...（页码：p.X）\",\n"
    "  \"推荐方法\": \"PDCA; AHP; GB50300-2013; 随机抽样调查（样本量≥300）; 现场质量抽检流程\",\n"
    "  \"可借鉴网络案例\": \"《某地项目A》（来源：网络案例深度研究报告2025XXXX.md）；《某地项目B》（来源：网络案例深度研究报告2025YYYY.md）\"\n"
    "}}"
)

# 统一模板，无需 SOP 切换

# 研究增强查询与参数

# 用于在研究简报生成前，基于主题追加若干通用增强查询（配置驱动，避免业务硬编码）
ENHANCEMENT_QUERIES = [
    "最佳实践案例和成功经验",
    "常见问题和风险因素",
    "绩效评价指标和评价方法",
    "相关的政策法规和标准规范",
]

RESEARCH_DECOMPOSITION_NUMS = 2
RESEARCH_URLS_PER_QUERY = 3


EVIDENCE_CATEGORIES = [
    {"category": "项目基本信息", "keywords": ["项目名称", "项目背景", "主要目标"]},
    {"category": "资金预算", "keywords": ["预算金额", "资金来源", "支出明细"]},
    {"category": "实施内容", "keywords": ["实施方案", "技术措施", "管理流程"]},
    {"category": "绩效指标", "keywords": ["评价指标", "成果产出", "效益分析"]},
]
EVIDENCE_KEYWORD_MAPPING = {
    "预算资金数据": {"keywords": ["预算", "资金", "金额", "支出", "拨款"]},
    "目标指标设定": {"keywords": ["目标", "指标", "计划", "预期", "设定"]},
    "实施管理措施": {"keywords": ["实施", "管理", "措施", "方案", "流程"]},
    "实施效果数据": {"keywords": ["效果", "成果", "成效", "数据", "统计"]},
}

# LLM输入长度限制
MAX_INPUT_TOKENS = 120000

# 合并简报（可维护）提示词
MERGE_FIELD_PROMPT = (
    "你是项目研究的‘书记员’。请基于‘旧内容’与‘新素材’，输出该字段的最新整合文本：\n"
    "要求：\n"
    "1) 仅输出最终文本，不要输出JSON/说明\n"
    "2) 合并去重：保留更具体的事实（含数字/文号/时间优先），删除重复与矛盾\n"
    "3) 可分段、可换行，保证可读性\n"
    "4) 严禁虚构\n"
    "5) 若字段为‘推荐方法’，输出为‘方法; 标准; 工具; 模型; 流程’等要点清单，严禁写成问句\n"
    "6) 若字段为‘可借鉴网络案例’，输出为‘《案例名》（来源：文件名.后缀）；……’，严禁写成问句\n\n"
    "【字段】{field_name}\n"
    "【旧内容】\n{old_text}\n\n"
    "【新素材】\n{new_notes}\n"
)

MERGE_EVENTS_PROMPT = (
    "你是项目研究的‘书记员’。请基于‘旧事件清单’与‘新素材’整合出‘重要事件’时间线：\n"
    "要求：\n"
    "1) 仅输出事件清单文本（多行），每行格式：[YYYY-MM-DD HH:MM] 事件内容\n"
    "2) 去重与合并：相同日期且同类型的支付/拨付事件合并为单行并汇总金额\n"
    "3) 里程碑优先：立项/招标/合同/开工/验收/结算/关键支付节点优先呈现\n"
    "4) 排序：按时间升序；无法确定时间可写 [未知时间]\n"
    "5) 严禁虚构\n\n"
    "【旧事件清单】\n{old_events}\n\n"
    "【新素材】\n{new_notes}\n"
)


